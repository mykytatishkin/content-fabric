# üöÄ Parallel Voice Processing

## –ö—Ä–∞—Ç–∫–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ

–†–µ–∞–ª–∏–∑–æ–≤–∞–Ω –º–µ—Ö–∞–Ω–∏–∑–º –º–Ω–æ–≥–æ–ø–æ—Ç–æ—á–Ω–æ–π –æ–±—Ä–∞–±–æ—Ç–∫–∏ –≥–æ–ª–æ—Å–∞ –¥–ª—è –∑–Ω–∞—á–∏—Ç–µ–ª—å–Ω–æ–≥–æ —É—Å–∫–æ—Ä–µ–Ω–∏—è –ø—Ä–æ—Ü–µ—Å—Å–∞ –∏–∑–º–µ–Ω–µ–Ω–∏—è –≥–æ–ª–æ—Å–∞.

## ‚ú® –û—Å–Ω–æ–≤–Ω—ã–µ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏

- **‚ö° –ü–∞—Ä–∞–ª–ª–µ–ª—å–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞** - —Ä–∞–∑–¥–µ–ª–µ–Ω–∏–µ –Ω–∞ —Ñ—Ä–∞–≥–º–µ–Ω—Ç—ã –∏ –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞
- **üéµ –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ —Ñ–æ–Ω–æ–≤–æ–π –º—É–∑—ã–∫–∏** - –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ —Ä–∞–∑–¥–µ–ª–µ–Ω–∏–µ –≤–æ–∫–∞–ª–∞ –∏ —Ñ–æ–Ω–∞
- **üîÑ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π —Ä–µ–∂–∏–º** - –≤—ã–±–æ—Ä –æ–ø—Ç–∏–º–∞–ª—å–Ω–æ–≥–æ —Ä–µ–∂–∏–º–∞ –Ω–∞ –æ—Å–Ω–æ–≤–µ –¥–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ –∞—É–¥–∏–æ
- **üìä –ú–∞—Å—à—Ç–∞–±–∏—Ä—É–µ–º–æ—Å—Ç—å** - –Ω–∞—Å—Ç—Ä–∞–∏–≤–∞–µ–º–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø–æ—Ç–æ–∫–æ–≤ –∏ —Ä–∞–∑–º–µ—Ä —Ñ—Ä–∞–≥–º–µ–Ω—Ç–æ–≤

## üìã –ê–ª–≥–æ—Ä–∏—Ç–º —Ä–∞–±–æ—Ç—ã

```
–ò–Ω–ø—É—Ç ‚Üí –†–∞–∑–¥–µ–ª–µ–Ω–∏–µ –Ω–∞ —Ñ—Ä–∞–≥–º–µ–Ω—Ç—ã (5 –º–∏–Ω) ‚Üí 
        –ü–∞—Ä–∞–ª–ª–µ–ª—å–Ω–∞—è —Ç—Ä–∞–Ω—Å–∫—Ä–∏–±–∞—Ü–∏—è ‚Üí 
        –ü–∞—Ä–∞–ª–ª–µ–ª—å–Ω–∞—è –ø–µ—Ä–µ–æ–∑–≤—É—á–∫–∞ ‚Üí 
        –°–±–æ—Ä–∫–∞ –≤ –µ–¥–∏–Ω—ã–π —Ñ–∞–π–ª ‚Üí –ê—É—Ç–ø—É—Ç
```

### –° —Ñ–æ–Ω–æ–≤–æ–π –º—É–∑—ã–∫–æ–π:

```
–ò–Ω–ø—É—Ç ‚Üí –†–∞–∑–¥–µ–ª–µ–Ω–∏–µ –≤–æ–∫–∞–ª/—Ñ–æ–Ω ‚Üí 
        –†–∞–∑–¥–µ–ª–µ–Ω–∏–µ –≤–æ–∫–∞–ª–∞ –Ω–∞ —Ñ—Ä–∞–≥–º–µ–Ω—Ç—ã (5 –º–∏–Ω) ‚Üí
        –ü–∞—Ä–∞–ª–ª–µ–ª—å–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ —Ñ—Ä–∞–≥–º–µ–Ω—Ç–æ–≤ ‚Üí
        –°–±–æ—Ä–∫–∞ –≤–æ–∫–∞–ª–∞ ‚Üí
        –°–º–µ—à–∏–≤–∞–Ω–∏–µ —Å –æ—Ä–∏–≥–∏–Ω–∞–ª—å–Ω—ã–º —Ñ–æ–Ω–æ–º ‚Üí –ê—É—Ç–ø—É—Ç
```

## üöÄ –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç

### –ë–∞–∑–æ–≤–æ–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ

```python
from core.utils.voice_changer import VoiceChanger

# –°–æ–∑–¥–∞—Ç—å voice changer —Å –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ–π –æ–±—Ä–∞–±–æ—Ç–∫–æ–π
changer = VoiceChanger(
    enable_parallel=True,
    chunk_duration_minutes=5,
    max_workers=4
)

# –û–±—Ä–∞–±–æ—Ç–∞—Ç—å —Ñ–∞–π–ª
result = changer.process_file(
    input_file='input.mp3',
    output_file='output.mp3',
    method='silero',
    voice_model='kseniya'
)

# –û—á–∏—Å—Ç–∫–∞
changer.cleanup()
```

### –° —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ–º —Ñ–æ–Ω–æ–≤–æ–π –º—É–∑—ã–∫–∏

```python
result = changer.process_file(
    input_file='audio_with_music.mp3',
    output_file='output_with_music.mp3',
    method='silero',
    voice_model='kseniya',
    preserve_background=True  # ‚Üê –°–æ—Ö—Ä–∞–Ω–∏—Ç—å —Ñ–æ–Ω!
)
```

## üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

```bash
# –ü–æ–ª–Ω—ã–π —Ç–µ—Å—Ç
python test_parallel_voice_processing.py --mode full

# –¢–µ—Å—Ç –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∞
python test_parallel_voice_processing.py --mode component
```

## üìä –û–∂–∏–¥–∞–µ–º–æ–µ —É—Å–∫–æ—Ä–µ–Ω–∏–µ

| –î–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å | –†–µ–∂–∏–º | –û–∂–∏–¥–∞–µ–º–æ–µ —É—Å–∫–æ—Ä–µ–Ω–∏–µ |
|--------------|-------|---------------------|
| < 3 –º–∏–Ω | –ü–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω—ã–π | 1x (baseline) |
| 3-10 –º–∏–Ω | –ü–∞—Ä–∞–ª–ª–µ–ª—å–Ω—ã–π (5 –º–∏–Ω) | 1.5-2x |
| 10-20 –º–∏–Ω | –ü–∞—Ä–∞–ª–ª–µ–ª—å–Ω—ã–π (5 –º–∏–Ω) | 2-3x |
| > 20 –º–∏–Ω | –ü–∞—Ä–∞–ª–ª–µ–ª—å–Ω—ã–π (3 –º–∏–Ω) | 3-4x |

*–†–µ–∑—É–ª—å—Ç–∞—Ç—ã –∑–∞–≤–∏—Å—è—Ç –æ—Ç –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ CPU —è–¥–µ—Ä –∏ —Ç–∏–ø–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∏*

## ‚öôÔ∏è –ü–∞—Ä–∞–º–µ—Ç—Ä—ã –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏

### VoiceChanger

- `enable_parallel` - –≤–∫–ª—é—á–∏—Ç—å –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω—É—é –æ–±—Ä–∞–±–æ—Ç–∫—É (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é: `True`)
- `chunk_duration_minutes` - –¥–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å —Ñ—Ä–∞–≥–º–µ–Ω—Ç–æ–≤ (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é: `5`)
- `max_workers` - –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø–æ—Ç–æ–∫–æ–≤ (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é: CPU count)

### process_file

- `preserve_background` - —Å–æ—Ö—Ä–∞–Ω–∏—Ç—å —Ñ–æ–Ω (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é: `False`)
- `use_parallel` - —Ä–µ–∂–∏–º –æ–±—Ä–∞–±–æ—Ç–∫–∏ (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é: `None` - –∞–≤—Ç–æ)
- `vocals_gain` - –≥—Ä–æ–º–∫–æ—Å—Ç—å –≤–æ–∫–∞–ª–∞ –≤ dB (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é: `0.0`)
- `background_gain` - –≥—Ä–æ–º–∫–æ—Å—Ç—å —Ñ–æ–Ω–∞ –≤ dB (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é: `-3.0`)

## üìÅ –°—Ç—Ä—É–∫—Ç—É—Ä–∞ —Ñ–∞–π–ª–æ–≤

### –ù–æ–≤—ã–µ —Ñ–∞–π–ª—ã

- `core/utils/parallel_voice_processor.py` - –æ—Å–Ω–æ–≤–Ω–æ–π –ø—Ä–æ—Ü–µ—Å—Å–æ—Ä
- `test_parallel_voice_processing.py` - —Ç–µ—Å—Ç–æ–≤—ã–π —Å–∫—Ä–∏–ø—Ç
- `docs/PARALLEL_VOICE_PROCESSING.md` - –ø–æ–ª–Ω–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è
- `PARALLEL_PROCESSING_README.md` - —ç—Ç–æ —Ñ–∞–π–ª

### –ú–æ–¥–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã

- `core/utils/voice_changer.py` - –¥–æ–±–∞–≤–ª–µ–Ω–∞ –ø–æ–¥–¥–µ—Ä–∂–∫–∞ –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ–π –æ–±—Ä–∞–±–æ—Ç–∫–∏

## üîß –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ –¥–µ—Ç–∞–ª–∏

### –ö–æ–º–ø–æ–Ω–µ–Ω—Ç—ã

1. **ParallelVoiceProcessor** - —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ–π –æ–±—Ä–∞–±–æ—Ç–∫–æ–π
   - –†–∞–∑–¥–µ–ª–µ–Ω–∏–µ –∞—É–¥–∏–æ –Ω–∞ —Ñ—Ä–∞–≥–º–µ–Ω—Ç—ã
   - –ú–Ω–æ–≥–æ–ø–æ—Ç–æ—á–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞
   - –°–±–æ—Ä–∫–∞ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ —Å crossfade

2. **VoiceChanger** (—Ä–∞—Å—à–∏—Ä–µ–Ω–Ω—ã–π) - –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è
   - –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –≤—ã–±–æ—Ä —Ä–µ–∂–∏–º–∞
   - –ü–æ–¥–¥–µ—Ä–∂–∫–∞ —Ñ–æ–Ω–æ–≤–æ–π –º—É–∑—ã–∫–∏
   - –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –≤—Ä–µ–º–µ–Ω–Ω—ã–º–∏ —Ñ–∞–π–ª–∞–º–∏

3. **AudioBackgroundMixer** (–∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è) - —Ä–∞–±–æ—Ç–∞ —Å —Ñ–æ–Ω–æ–º
   - –†–∞–∑–¥–µ–ª–µ–Ω–∏–µ –≤–æ–∫–∞–ª–∞ –∏ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–∞–ª–∞
   - –°–º–µ—à–∏–≤–∞–Ω–∏–µ –æ–±—Ä–∞–±–æ—Ç–∞–Ω–Ω–æ–≥–æ –≤–æ–∫–∞–ª–∞

### –í—Ä–µ–º–µ–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã

```
temp_dir/
‚îú‚îÄ‚îÄ parallel/
‚îÇ   ‚îú‚îÄ‚îÄ chunks/              # –ò—Å—Ö–æ–¥–Ω—ã–µ —Ñ—Ä–∞–≥–º–µ–Ω—Ç—ã
‚îÇ   ‚îú‚îÄ‚îÄ processed_chunks/    # –û–±—Ä–∞–±–æ—Ç–∞–Ω–Ω—ã–µ —Ñ—Ä–∞–≥–º–µ–Ω—Ç—ã
‚îÇ   ‚îî‚îÄ‚îÄ separation/          # –†–∞–∑–¥–µ–ª–µ–Ω–∏–µ –≤–æ–∫–∞–ª/—Ñ–æ–Ω
‚îî‚îÄ‚îÄ background_preservation/
    ‚îî‚îÄ‚îÄ processed_vocals.wav
```

## üéØ –ü—Ä–∏–º–µ—Ä—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è

### –ü—Ä–∏–º–µ—Ä 1: –û–±—Ä–∞–±–æ—Ç–∫–∞ –ø–æ–¥–∫–∞—Å—Ç–∞

```python
changer = VoiceChanger(enable_parallel=True)

result = changer.process_file(
    input_file='podcast.mp3',
    output_file='podcast_new_voice.mp3',
    method='silero',
    voice_model='kseniya'
)

print(f"‚úÖ –û–±—Ä–∞–±–æ—Ç–∞–Ω–æ –∑–∞ {result.get('duration', 0):.2f}—Å")
changer.cleanup()
```

### –ü—Ä–∏–º–µ—Ä 2: –ê—É–¥–∏–æ–∫–Ω–∏–≥–∞ —Å –º—É–∑—ã–∫–æ–π

```python
changer = VoiceChanger(
    enable_parallel=True,
    chunk_duration_minutes=5
)

result = changer.process_file(
    input_file='audiobook_with_music.mp3',
    output_file='audiobook_female_voice.mp3',
    method='silero',
    voice_model='kseniya',
    preserve_background=True,
    vocals_gain=1.0,
    background_gain=-4.0
)

changer.cleanup()
```

### –ü—Ä–∏–º–µ—Ä 3: Batch –æ–±—Ä–∞–±–æ—Ç–∫–∞

```python
from pathlib import Path

changer = VoiceChanger(enable_parallel=True, chunk_duration_minutes=5)

for audio_file in Path("input_dir").glob("*.mp3"):
    output_file = Path("output_dir") / f"processed_{audio_file.name}"
    
    result = changer.process_file(
        input_file=str(audio_file),
        output_file=str(output_file),
        method='silero',
        voice_model='kseniya'
    )
    
    print(f"‚úÖ {audio_file.name} ‚Üí {output_file.name}")

changer.cleanup()
```

## üêõ Troubleshooting

### –ú–µ–¥–ª–µ–Ω–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞

```python
# –£–º–µ–Ω—å—à–∏—Ç—å —Ä–∞–∑–º–µ—Ä —Ñ—Ä–∞–≥–º–µ–Ω—Ç–æ–≤
changer = VoiceChanger(
    enable_parallel=True,
    chunk_duration_minutes=3,  # ‚Üê –ú–µ–Ω—å—à–µ —Ñ—Ä–∞–≥–º–µ–Ω—Ç—ã
    max_workers=8              # ‚Üê –ë–æ–ª—å—à–µ –ø–æ—Ç–æ–∫–æ–≤
)
```

### –û—à–∏–±–∫–∏ –ø–∞–º—è—Ç–∏

```python
# –£–≤–µ–ª–∏—á–∏—Ç—å —Ä–∞–∑–º–µ—Ä —Ñ—Ä–∞–≥–º–µ–Ω—Ç–æ–≤, —É–º–µ–Ω—å—à–∏—Ç—å –ø–æ—Ç–æ–∫–∏
changer = VoiceChanger(
    enable_parallel=True,
    chunk_duration_minutes=10,  # ‚Üê –ë–æ–ª—å—à–µ —Ñ—Ä–∞–≥–º–µ–Ω—Ç—ã
    max_workers=2               # ‚Üê –ú–µ–Ω—å—à–µ –ø–æ—Ç–æ–∫–æ–≤
)
```

### –û—Ç–∫–ª—é—á–∏—Ç—å –¥–ª—è –∫–æ—Ä–æ—Ç–∫–∏—Ö —Ñ–∞–π–ª–æ–≤

```python
# –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π —Ä–µ–∂–∏–º (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è)
result = changer.process_file(
    input_file='short.mp3',
    output_file='output.mp3',
    method='silero',
    use_parallel=None  # ‚Üê –ê–≤—Ç–æ: –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ –¥–ª—è < 3 –º–∏–Ω
)
```

## üìö –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è

- **–ü–æ–ª–Ω–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è**: `docs/PARALLEL_VOICE_PROCESSING.md`
- **API Reference**: –°–º. –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—é
- **–ü—Ä–∏–º–µ—Ä—ã**: `test_parallel_voice_processing.py`

## ‚úÖ –ß–µ–∫–ª–∏—Å—Ç —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏

- [x] –°–æ–∑–¥–∞–Ω ParallelVoiceProcessor —Å —Ä–∞–∑–¥–µ–ª–µ–Ω–∏–µ–º –Ω–∞ —Ñ—Ä–∞–≥–º–µ–Ω—Ç—ã
- [x] –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–∞ –º–Ω–æ–≥–æ–ø–æ—Ç–æ—á–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ —Ñ—Ä–∞–≥–º–µ–Ω—Ç–æ–≤
- [x] –î–æ–±–∞–≤–ª–µ–Ω–∞ –ø–æ–¥–¥–µ—Ä–∂–∫–∞ —Ñ–æ–Ω–æ–≤–æ–π –º—É–∑—ã–∫–∏
- [x] –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–∞ —Å–±–æ—Ä–∫–∞ —Ñ—Ä–∞–≥–º–µ–Ω—Ç–æ–≤ —Å crossfade
- [x] –ò–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞–Ω–æ –≤ VoiceChanger
- [x] –°–æ–∑–¥–∞–Ω —Ç–µ—Å—Ç–æ–≤—ã–π —Å–∫—Ä–∏–ø—Ç
- [x] –ù–∞–ø–∏—Å–∞–Ω–∞ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è

## üöÄ –°–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏

1. –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å –Ω–∞ —Ä–µ–∞–ª—å–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö
2. –ù–∞—Å—Ç—Ä–æ–∏—Ç—å –æ–ø—Ç–∏–º–∞–ª—å–Ω—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã
3. –î–æ–±–∞–≤–∏—Ç—å –ø—Ä–æ–≥—Ä–µ—Å—Å-–±–∞—Ä (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
4. GPU —É—Å–∫–æ—Ä–µ–Ω–∏–µ (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)

---

**–ì–æ—Ç–æ–≤–æ –∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é! üéâ**

–î–ª—è –Ω–∞—á–∞–ª–∞ —Ä–∞–±–æ—Ç—ã –∑–∞–ø—É—Å—Ç–∏—Ç–µ —Ç–µ—Å—Ç–æ–≤—ã–π —Å–∫—Ä–∏–ø—Ç:
```bash
python test_parallel_voice_processing.py --mode full
```

