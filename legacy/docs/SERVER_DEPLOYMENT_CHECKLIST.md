# ‚úÖ –ß–µ–∫–ª–∏—Å—Ç –ø–µ—Ä–µ–¥ –∑–∞–ø—É—Å–∫–æ–º –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ

## üîç –ü—Ä–æ–≤–µ—Ä–∫–∞ –≥–æ—Ç–æ–≤–Ω–æ—Å—Ç–∏

### 1. –ú–∏–≥—Ä–∞—Ü–∏—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∞ ‚úÖ

```bash
# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å, —á—Ç–æ –º–∏–≥—Ä–∞—Ü–∏—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∞
python3 core/database/migrations/add_google_consoles_migration.py
```

**–î–æ–ª–∂–Ω–æ –±—ã—Ç—å:**
- ‚úÖ –¢–∞–±–ª–∏—Ü–∞ `google_consoles` —Å—É—â–µ—Å—Ç–≤—É–µ—Ç
- ‚úÖ –ü–æ–ª–µ `console_name` –¥–æ–±–∞–≤–ª–µ–Ω–æ –≤ `youtube_channels`
- ‚úÖ –ü–æ–ª—è `client_id` –∏ `client_secret` —Å–¥–µ–ª–∞–Ω—ã nullable

### 2. –ö–æ–Ω—Å–æ–ª–∏ –Ω–∞—Å—Ç—Ä–æ–µ–Ω—ã ‚úÖ

```python
from core.database.mysql_db import get_mysql_database

db = get_mysql_database()
consoles = db.get_all_google_consoles()
print(f"–ö–æ–Ω—Å–æ–ª–µ–π: {len(consoles)}")
```

**–î–æ–ª–∂–Ω–æ –±—ã—Ç—å:**
- ‚úÖ –ú–∏–Ω–∏–º—É–º –æ–¥–Ω–∞ –∫–æ–Ω—Å–æ–ª—å –≤ —Ç–∞–±–ª–∏—Ü–µ `google_consoles`
- ‚úÖ –í—Å–µ –∫–æ–Ω—Å–æ–ª–∏ –≤–∫–ª—é—á–µ–Ω—ã (enabled=1)

### 3. –ö–∞–Ω–∞–ª—ã –∏–º–µ—é—Ç credentials ‚úÖ

```python
channels = db.get_all_channels(enabled_only=True)
for channel in channels:
    creds = db.get_console_credentials_for_channel(channel.name)
    if not creds:
        print(f"‚ùå {channel.name}: –Ω–µ—Ç credentials")
```

**–î–æ–ª–∂–Ω–æ –±—ã—Ç—å:**
- ‚úÖ –í—Å–µ –∫–∞–Ω–∞–ª—ã –∏–º–µ—é—Ç credentials (–∏–∑ `google_consoles` –∏–ª–∏ fallback)

### 4. –¢–æ–∫–µ–Ω—ã –∫–∞–Ω–∞–ª–æ–≤ (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)

```python
for channel in channels:
    if not (channel.access_token and channel.refresh_token):
        print(f"‚ö†Ô∏è  {channel.name}: –Ω–µ—Ç —Ç–æ–∫–µ–Ω–æ–≤")
```

**–†–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è:**
- ‚úÖ –í—Å–µ –∫–∞–Ω–∞–ª—ã –∏–º–µ—é—Ç —Ç–æ–∫–µ–Ω—ã (access_token + refresh_token)
- ‚ö†Ô∏è –ï—Å–ª–∏ –Ω–µ—Ç —Ç–æ–∫–µ–Ω–æ–≤ - –æ–Ω–∏ –±—É–¥—É—Ç –ø–æ–ª—É—á–µ–Ω—ã –ø—Ä–∏ –ø–µ—Ä–≤–æ–π –ø—É–±–ª–∏–∫–∞—Ü–∏–∏ (—á–µ—Ä–µ–∑ OAuth flow)

---

## üöÄ –ó–∞–ø—É—Å–∫ –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ

### –ü—Ä–æ—Å—Ç–æ–π –∑–∞–ø—É—Å–∫:

```bash
cd /path/to/content-fabric
python3 run_task_worker.py
```

### –ó–∞–ø—É—Å–∫ –≤ —Ñ–æ–Ω–æ–≤–æ–º —Ä–µ–∂–∏–º–µ:

```bash
cd /path/to/content-fabric
nohup python3 run_task_worker.py > task_worker.log 2>&1 &
```

### –ß–µ—Ä–µ–∑ systemd (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è):

```ini
[Unit]
Description=Content Fabric Task Worker
After=network.target mysql.service

[Service]
Type=simple
User=your_user
WorkingDirectory=/path/to/content-fabric
ExecStart=/usr/bin/python3 /path/to/content-fabric/run_task_worker.py
Restart=always
RestartSec=10

[Install]
WantedBy=multi-user.target
```

---

## ‚úÖ –ß—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏

1. **–ó–∞–≥—Ä—É–∑–∫–∞ credentials –∏–∑ `google_consoles`**
   - –ï—Å–ª–∏ —É –∫–∞–Ω–∞–ª–∞ –µ—Å—Ç—å `console_name` ‚Üí –±–µ—Ä–µ—Ç –∏–∑ `google_consoles`
   - –ï—Å–ª–∏ –Ω–µ—Ç `console_name` ‚Üí fallback –Ω–∞ —Å—Ç–∞—Ä—ã–µ –ø–æ–ª—è

2. **–û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Ç–æ–∫–µ–Ω–æ–≤**
   - –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –æ–±–Ω–æ–≤–ª—è–µ—Ç —Ç–æ–∫–µ–Ω—ã —á–µ—Ä–µ–∑ `refresh_token`
   - –†–∞–±–æ—Ç–∞–µ—Ç, –µ—Å–ª–∏ —Ç–æ–∫–µ–Ω –≤—ã–¥–∞–Ω –¥–ª—è –ø—Ä–∞–≤–∏–ª—å–Ω–æ–π –∫–æ–Ω—Å–æ–ª–∏

3. **–û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫**
   - –õ–æ–≤–∏—Ç –æ—à–∏–±–∫–∏ `invalid_grant`, `unauthorized_client`
   - –õ–æ–≥–∏—Ä—É–µ—Ç –∏ –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è

4. **–ü—É–±–ª–∏–∫–∞—Ü–∏—è –≤–∏–¥–µ–æ**
   - –ò—Å–ø–æ–ª—å–∑—É–µ—Ç –ø—Ä–∞–≤–∏–ª—å–Ω—ã–µ credentials –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –∫–∞–Ω–∞–ª–∞
   - –ö–∞–∂–¥–∞—è –∫–æ–Ω—Å–æ–ª—å –∏–º–µ–µ—Ç —Å–≤–æ–π –Ω–µ–∑–∞–≤–∏—Å–∏–º—ã–π –∫–≤–æ—Ç

---

## ‚ö†Ô∏è –ß—Ç–æ –ù–ï —Ä–∞–±–æ—Ç–∞–µ—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏

1. **–ü–µ—Ä–µ–∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è –ø—Ä–∏ —Å–º–µ–Ω–µ –∫–æ–Ω—Å–æ–ª–∏**
   - –ï—Å–ª–∏ –∏–∑–º–µ–Ω–∏–ª–∏ `console_name` –∫–∞–Ω–∞–ª–∞ ‚Üí –Ω—É–∂–Ω–æ –ø–µ—Ä–µ–∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞—Ç—å –≤—Ä—É—á–Ω—É—é
   - –ö–æ–º–∞–Ω–¥–∞: `python3 run_youtube_reauth.py "Channel Name"`

2. **–ü–µ—Ä–µ–∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è –ø—Ä–∏ –æ—à–∏–±–∫–µ `unauthorized_client`**
   - –ù—É–∂–Ω–∞ —Ä—É—á–Ω–∞—è –ø–µ—Ä–µ–∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è
   - –ö–æ–º–∞–Ω–¥–∞: `python3 run_youtube_reauth.py "Channel Name"`

3. **–ü—Ä–∏–≤—è–∑–∫–∞ –∫–∞–Ω–∞–ª–æ–≤ –∫ –∫–æ–Ω—Å–æ–ª—è–º**
   - –ù—É–∂–Ω–æ –≤—Ä—É—á–Ω—É—é —É—Å—Ç–∞–Ω–æ–≤–∏—Ç—å `console_name` –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –∫–∞–Ω–∞–ª–∞
   - SQL: `UPDATE youtube_channels SET console_name = 'Console Name' WHERE name = 'Channel Name'`

---

## üìã –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –ø–µ—Ä–µ–¥ –∑–∞–ø—É—Å–∫–æ–º

### –ú–∏–Ω–∏–º–∞–ª—å–Ω—ã–µ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è:

- ‚úÖ –ú–∏–≥—Ä–∞—Ü–∏—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∞
- ‚úÖ –ú–∏–Ω–∏–º—É–º –æ–¥–Ω–∞ –∫–æ–Ω—Å–æ–ª—å –≤ `google_consoles`
- ‚úÖ –í—Å–µ –∫–∞–Ω–∞–ª—ã –∏–º–µ—é—Ç credentials (—Ö–æ—Ç—è –±—ã —á–µ—Ä–µ–∑ fallback)
- ‚úÖ –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è MySQL –¥–æ—Å—Ç—É–ø–Ω–∞ (`config/mysql_config.yaml`)

### –û–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è):

- ‚úÖ –í—Å–µ –∫–∞–Ω–∞–ª—ã –ø—Ä–∏–≤—è–∑–∞–Ω—ã –∫ –∫–æ–Ω—Å–æ–ª—è–º —á–µ—Ä–µ–∑ `console_name`
- ‚úÖ –í—Å–µ –∫–∞–Ω–∞–ª—ã –∏–º–µ—é—Ç —Ç–æ–∫–µ–Ω—ã (access_token + refresh_token)
- ‚úÖ –†–∞–∑–Ω—ã–µ –∫–∞–Ω–∞–ª—ã –∏—Å–ø–æ–ª—å–∑—É—é—Ç —Ä–∞–∑–Ω—ã–µ –∫–æ–Ω—Å–æ–ª–∏ (–¥–ª—è —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è –∫–≤–æ—Ç—ã)

---

## üîß –ë—ã—Å—Ç—Ä–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ –ø–µ—Ä–µ–¥ –∑–∞–ø—É—Å–∫–æ–º

```bash
cd /path/to/content-fabric
python3 -c "
from core.database.mysql_db import get_mysql_database

db = get_mysql_database()

# –ü—Ä–æ–≤–µ—Ä–∫–∞ 1: –ö–æ–Ω—Å–æ–ª–∏
consoles = db.get_all_google_consoles()
print(f'‚úÖ –ö–æ–Ω—Å–æ–ª–µ–π: {len(consoles)}')

# –ü—Ä–æ–≤–µ—Ä–∫–∞ 2: –ö–∞–Ω–∞–ª—ã
channels = db.get_all_channels(enabled_only=True)
print(f'‚úÖ –ö–∞–Ω–∞–ª–æ–≤: {len(channels)}')

# –ü—Ä–æ–≤–µ—Ä–∫–∞ 3: Credentials
all_ok = True
for channel in channels:
    creds = db.get_console_credentials_for_channel(channel.name)
    if not creds:
        print(f'‚ùå {channel.name}: –Ω–µ—Ç credentials')
        all_ok = False

if all_ok:
    print('‚úÖ –í—Å–µ –∫–∞–Ω–∞–ª—ã –∏–º–µ—é—Ç credentials')
    print('‚úÖ –ì–æ—Ç–æ–≤–æ –∫ –∑–∞–ø—É—Å–∫—É!')
else:
    print('‚ùå –ù—É–∂–Ω–æ –Ω–∞—Å—Ç—Ä–æ–∏—Ç—å credentials –¥–ª—è –Ω–µ–∫–æ—Ç–æ—Ä—ã—Ö –∫–∞–Ω–∞–ª–æ–≤')
"
```

---

## üéØ –ò—Ç–æ–≥

**–î–∞, –º–æ–∂–Ω–æ –ø—Ä–æ—Å—Ç–æ –∑–∞–ø—É—Å—Ç–∏—Ç—å –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ!**

–°–∏—Å—Ç–µ–º–∞ –±—É–¥–µ—Ç —Ä–∞–±–æ—Ç–∞—Ç—å, –ø–æ—Ç–æ–º—É —á—Ç–æ:
- ‚úÖ –ú–∏–≥—Ä–∞—Ü–∏—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∞
- ‚úÖ Credentials –∑–∞–≥—Ä—É–∂–∞—é—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ (–∏–∑ `google_consoles` –∏–ª–∏ fallback)
- ‚úÖ –¢–æ–∫–µ–Ω—ã –æ–±–Ω–æ–≤–ª—è—é—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ (–µ—Å–ª–∏ –≤—ã–¥–∞–Ω –¥–ª—è –ø—Ä–∞–≤–∏–ª—å–Ω–æ–π –∫–æ–Ω—Å–æ–ª–∏)
- ‚úÖ –û–±—Ä–∞—Ç–Ω–∞—è —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∞ (–∫–∞–Ω–∞–ª—ã –±–µ–∑ `console_name` –∏—Å–ø–æ–ª—å–∑—É—é—Ç fallback)

**–ß—Ç–æ –º–æ–∂–µ—Ç –ø–æ—Ç—Ä–µ–±–æ–≤–∞—Ç—å –≤–Ω–∏–º–∞–Ω–∏—è:**
- ‚ö†Ô∏è –ö–∞–Ω–∞–ª—ã –±–µ–∑ —Ç–æ–∫–µ–Ω–æ–≤ - –±—É–¥—É—Ç –ø–æ–ª—É—á–µ–Ω—ã –ø—Ä–∏ –ø–µ—Ä–≤–æ–π –ø—É–±–ª–∏–∫–∞—Ü–∏–∏
- ‚ö†Ô∏è –ö–∞–Ω–∞–ª—ã —Å –æ—à–∏–±–∫–æ–π `unauthorized_client` - –Ω—É–∂–Ω–∞ –ø–µ—Ä–µ–∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è
- ‚ö†Ô∏è –ö–∞–Ω–∞–ª—ã –±–µ–∑ `console_name` - –∏—Å–ø–æ–ª—å–∑—É—é—Ç fallback (—Ä–∞–±–æ—Ç–∞–µ—Ç, –Ω–æ –ª—É—á—à–µ –ø—Ä–∏–≤—è–∑–∞—Ç—å)

