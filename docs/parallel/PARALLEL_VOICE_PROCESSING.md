# Parallel Voice Processing Guide

## –û–±–∑–æ—Ä

–°–∏—Å—Ç–µ–º–∞ –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ–π –æ–±—Ä–∞–±–æ—Ç–∫–∏ –≥–æ–ª–æ—Å–∞ –ø–æ–∑–≤–æ–ª—è–µ—Ç –∑–Ω–∞—á–∏—Ç–µ–ª—å–Ω–æ —É—Å–∫–æ—Ä–∏—Ç—å –ø—Ä–æ—Ü–µ—Å—Å –∏–∑–º–µ–Ω–µ–Ω–∏—è –≥–æ–ª–æ—Å–∞ –∑–∞ —Å—á–µ—Ç —Ä–∞–∑–¥–µ–ª–µ–Ω–∏—è –∞—É–¥–∏–æ –Ω–∞ —Ñ—Ä–∞–≥–º–µ–Ω—Ç—ã –∏ –∏—Ö –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ–π –æ–±—Ä–∞–±–æ—Ç–∫–∏ –≤ –Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö –ø–æ—Ç–æ–∫–∞—Ö.

## –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞

### –û—Å–Ω–æ–≤–Ω—ã–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã

1. **ParallelVoiceProcessor** (`core/utils/parallel_voice_processor.py`)
   - –†–∞–∑–¥–µ–ª–µ–Ω–∏–µ –∞—É–¥–∏–æ –Ω–∞ —Ñ—Ä–∞–≥–º–µ–Ω—Ç—ã
   - –ú–Ω–æ–≥–æ–ø–æ—Ç–æ—á–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞
   - –°–±–æ—Ä–∫–∞ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤

2. **VoiceChanger** (–æ–±–Ω–æ–≤–ª–µ–Ω–Ω—ã–π)
   - –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω—ã–º –ø—Ä–æ—Ü–µ—Å—Å–æ—Ä–æ–º
   - –ü–æ–¥–¥–µ—Ä–∂–∫–∞ —Ñ–æ–Ω–æ–≤–æ–π –º—É–∑—ã–∫–∏
   - –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –≤—ã–±–æ—Ä —Ä–µ–∂–∏–º–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∏

3. **AudioBackgroundMixer** (–∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è)
   - –†–∞–∑–¥–µ–ª–µ–Ω–∏–µ –≤–æ–∫–∞–ª–∞ –∏ —Ñ–æ–Ω–∞
   - –°–º–µ—à–∏–≤–∞–Ω–∏–µ –æ–±—Ä–∞–±–æ—Ç–∞–Ω–Ω–æ–≥–æ –≤–æ–∫–∞–ª–∞ —Å —Ñ–æ–Ω–æ–º

## –ê–ª–≥–æ—Ä–∏—Ç–º —Ä–∞–±–æ—Ç—ã

### –°—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–∞—è –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞

```
–í—Ö–æ–¥ ‚Üí –†–∞–∑–¥–µ–ª–µ–Ω–∏–µ –Ω–∞ —Ñ—Ä–∞–≥–º–µ–Ω—Ç—ã (5 –º–∏–Ω) ‚Üí –ü–∞—Ä–∞–ª–ª–µ–ª—å–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ ‚Üí –°–±–æ—Ä–∫–∞ ‚Üí –í—ã—Ö–æ–¥
```

1. **–†–∞–∑–¥–µ–ª–µ–Ω–∏–µ**: –ê—É–¥–∏–æ –¥–µ–ª–∏—Ç—Å—è –Ω–∞ —Ñ—Ä–∞–≥–º–µ–Ω—Ç—ã –ø–æ 5 –º–∏–Ω—É—Ç (–Ω–∞—Å—Ç—Ä–∞–∏–≤–∞–µ–º–æ)
2. **–¢—Ä–∞–Ω—Å–∫—Ä–∏–±–∞—Ü–∏—è**: –ö–∞–∂–¥—ã–π —Ñ—Ä–∞–≥–º–µ–Ω—Ç —Ç—Ä–∞–Ω—Å–∫—Ä–∏–±–∏—Ä—É–µ—Ç—Å—è –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ
3. **–ü–µ—Ä–µ–æ–∑–≤—É—á–∫–∞**: –§—Ä–∞–≥–º–µ–Ω—Ç—ã –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—é—Ç—Å—è —á–µ—Ä–µ–∑ voice changer
4. **–°–±–æ—Ä–∫–∞**: –§—Ä–∞–≥–º–µ–Ω—Ç—ã —Å–æ–±–∏—Ä–∞—é—Ç—Å—è –≤ –µ–¥–∏–Ω—ã–π —Ñ–∞–π–ª —Å crossfade

### –° —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ–º —Ñ–æ–Ω–æ–≤–æ–π –º—É–∑—ã–∫–∏

```
–í—Ö–æ–¥ ‚Üí –†–∞–∑–¥–µ–ª–µ–Ω–∏–µ –≤–æ–∫–∞–ª/—Ñ–æ–Ω ‚Üí –†–∞–∑–¥–µ–ª–µ–Ω–∏–µ –Ω–∞ —Ñ—Ä–∞–≥–º–µ–Ω—Ç—ã ‚Üí –ü–∞—Ä–∞–ª–ª–µ–ª—å–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ ‚Üí –°–±–æ—Ä–∫–∞ ‚Üí –°–º–µ—à–∏–≤–∞–Ω–∏–µ —Å —Ñ–æ–Ω–æ–º ‚Üí –í—ã—Ö–æ–¥
```

1. **–†–∞–∑–¥–µ–ª–µ–Ω–∏–µ –≤–æ–∫–∞–ª/—Ñ–æ–Ω**: –ò–∑–≤–ª–µ—á–µ–Ω–∏–µ —á–∏—Å—Ç–æ–≥–æ –≤–æ–∫–∞–ª–∞
2. **–†–∞–∑–¥–µ–ª–µ–Ω–∏–µ –Ω–∞ —Ñ—Ä–∞–≥–º–µ–Ω—Ç—ã**: –í–æ–∫–∞–ª –¥–µ–ª–∏—Ç—Å—è –Ω–∞ —á–∞—Å—Ç–∏
3. **–ü–∞—Ä–∞–ª–ª–µ–ª—å–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞**: –ö–∞–∂–¥—ã–π —Ñ—Ä–∞–≥–º–µ–Ω—Ç –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç—Å—è
4. **–°–±–æ—Ä–∫–∞ –≤–æ–∫–∞–ª–∞**: –°–æ–±–∏—Ä–∞—é—Ç—Å—è –æ–±—Ä–∞–±–æ—Ç–∞–Ω–Ω—ã–µ —Ñ—Ä–∞–≥–º–µ–Ω—Ç—ã
5. **–°–º–µ—à–∏–≤–∞–Ω–∏–µ**: –û–±—Ä–∞–±–æ—Ç–∞–Ω–Ω—ã–π –≤–æ–∫–∞–ª —Å–º–µ—à–∏–≤–∞–µ—Ç—Å—è —Å –æ—Ä–∏–≥–∏–Ω–∞–ª—å–Ω—ã–º —Ñ–æ–Ω–æ–º

## –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ

### –ë–∞–∑–æ–≤–æ–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ

```python
from core.utils.voice_changer import VoiceChanger

# –°–æ–∑–¥–∞—Ç—å voice changer —Å –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ–π –æ–±—Ä–∞–±–æ—Ç–∫–æ–π
changer = VoiceChanger(
    enable_parallel=True,
    chunk_duration_minutes=5,  # –î–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å —Ñ—Ä–∞–≥–º–µ–Ω—Ç–æ–≤
    max_workers=4              # –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø–æ—Ç–æ–∫–æ–≤
)

# –û–±—Ä–∞–±–æ—Ç–∞—Ç—å —Ñ–∞–π–ª
result = changer.process_file(
    input_file='input.mp3',
    output_file='output.mp3',
    method='silero',
    voice_model='kseniya'
)

# –û—á–∏—Å—Ç–∏—Ç—å –≤—Ä–µ–º–µ–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã
changer.cleanup()
```

### –° —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ–º —Ñ–æ–Ω–æ–≤–æ–π –º—É–∑—ã–∫–∏

```python
result = changer.process_file(
    input_file='input_with_music.mp3',
    output_file='output_with_music.mp3',
    method='silero',
    voice_model='kseniya',
    preserve_background=True  # –°–æ—Ö—Ä–∞–Ω–∏—Ç—å —Ñ–æ–Ω
)
```

### –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π —Ä–µ–∂–∏–º

–°–∏—Å—Ç–µ–º–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –≤—ã–±–∏—Ä–∞–µ—Ç —Ä–µ–∂–∏–º –æ–±—Ä–∞–±–æ—Ç–∫–∏:
- **< 3 –º–∏–Ω—É—Ç**: –ü–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞
- **> 3 –º–∏–Ω—É—Ç**: –ü–∞—Ä–∞–ª–ª–µ–ª—å–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞

```python
# –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –≤—ã–±–æ—Ä (use_parallel=None)
result = changer.process_file(
    input_file='input.mp3',
    output_file='output.mp3',
    method='silero',
    voice_model='kseniya',
    use_parallel=None  # –ê–≤—Ç–æ —Ä–µ–∂–∏–º (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é)
)
```

### –ü—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω—ã–π —Ä–µ–∂–∏–º

```python
# –í—Å–µ–≥–¥–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω—É—é –æ–±—Ä–∞–±–æ—Ç–∫—É
result = changer.process_file(
    input_file='input.mp3',
    output_file='output.mp3',
    method='silero',
    use_parallel=True  # –ü—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ
)

# –û—Ç–∫–ª—é—á–∏—Ç—å –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω—É—é –æ–±—Ä–∞–±–æ—Ç–∫—É
result = changer.process_file(
    input_file='input.mp3',
    output_file='output.mp3',
    method='silero',
    use_parallel=False  # –ü–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ
)
```

## –ü–∞—Ä–∞–º–µ—Ç—Ä—ã –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏

### VoiceChanger –ø–∞—Ä–∞–º–µ—Ç—Ä—ã

- `enable_parallel` (bool): –í–∫–ª—é—á–∏—Ç—å –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω—É—é –æ–±—Ä–∞–±–æ—Ç–∫—É (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é: True)
- `chunk_duration_minutes` (int): –î–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å —Ñ—Ä–∞–≥–º–µ–Ω—Ç–æ–≤ –≤ –º–∏–Ω—É—Ç–∞—Ö (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é: 5)
- `max_workers` (int): –ú–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø–æ—Ç–æ–∫–æ–≤ (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é: CPU count)

### process_file –ø–∞—Ä–∞–º–µ—Ç—Ä—ã

- `preserve_background` (bool): –°–æ—Ö—Ä–∞–Ω–∏—Ç—å —Ñ–æ–Ω–æ–≤—É—é –º—É–∑—ã–∫—É (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é: False)
- `use_parallel` (bool): –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω—É—é –æ–±—Ä–∞–±–æ—Ç–∫—É (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é: None - –∞–≤—Ç–æ)
- `vocals_gain` (float): –ì—Ä–æ–º–∫–æ—Å—Ç—å –≤–æ–∫–∞–ª–∞ –≤ dB (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é: 0.0)
- `background_gain` (float): –ì—Ä–æ–º–∫–æ—Å—Ç—å —Ñ–æ–Ω–∞ –≤ dB (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é: -3.0)

## –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

### –ó–∞–ø—É—Å–∫ —Ç–µ—Å—Ç–æ–≤

```bash
# –ü–æ–ª–Ω—ã–π —Ç–µ—Å—Ç –≤—Å–µ—Ö —Ä–µ–∂–∏–º–æ–≤
python test_parallel_voice_processing.py --mode full

# –¢–µ—Å—Ç —Ç–æ–ª—å–∫–æ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∞ –ø—Ä–æ—Ü–µ—Å—Å–æ—Ä–∞
python test_parallel_voice_processing.py --mode component
```

### –¢–µ—Å—Ç–æ–≤—ã–µ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏

–°–∫—Ä–∏–ø—Ç —Ç–µ—Å—Ç–∏—Ä—É–µ—Ç 4 —Ä–µ–∂–∏–º–∞:
1. –ü–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ (baseline)
2. –ü–∞—Ä–∞–ª–ª–µ–ª—å–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ (5 –º–∏–Ω —Ñ—Ä–∞–≥–º–µ–Ω—Ç—ã)
3. –ü–∞—Ä–∞–ª–ª–µ–ª—å–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ (3 –º–∏–Ω —Ñ—Ä–∞–≥–º–µ–Ω—Ç—ã)
4. –ü–∞—Ä–∞–ª–ª–µ–ª—å–Ω–∞—è + —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ —Ñ–æ–Ω–∞

### –ê–Ω–∞–ª–∏–∑ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏

–°–∫—Ä–∏–ø—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –≤—ã—á–∏—Å–ª—è–µ—Ç:
- –í—Ä–µ–º—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ –¥–ª—è –∫–∞–∂–¥–æ–≥–æ —Ä–µ–∂–∏–º–∞
- –£—Å–∫–æ—Ä–µ–Ω–∏–µ (speedup) –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ–π –æ–±—Ä–∞–±–æ—Ç–∫–∏
- –°—Ä–∞–≤–Ω–∏—Ç–µ–ª—å–Ω—ã–π –∞–Ω–∞–ª–∏–∑

## –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏

### –†–µ–∫–æ–º–µ–Ω–¥—É–µ–º—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏

#### –î–ª—è –∫–æ—Ä–æ—Ç–∫–∏—Ö —Ñ–∞–π–ª–æ–≤ (< 3 –º–∏–Ω—É—Ç)
```python
changer = VoiceChanger(enable_parallel=False)
```

#### –î–ª—è —Å—Ä–µ–¥–Ω–∏—Ö —Ñ–∞–π–ª–æ–≤ (3-15 –º–∏–Ω—É—Ç)
```python
changer = VoiceChanger(
    enable_parallel=True,
    chunk_duration_minutes=5,
    max_workers=4
)
```

#### –î–ª—è –¥–ª–∏–Ω–Ω—ã—Ö —Ñ–∞–π–ª–æ–≤ (> 15 –º–∏–Ω—É—Ç)
```python
changer = VoiceChanger(
    enable_parallel=True,
    chunk_duration_minutes=3,  # –ú–µ–Ω—å—à–µ —Ñ—Ä–∞–≥–º–µ–Ω—Ç—ã = –±–æ–ª—å—à–µ –ø–∞—Ä–∞–ª–ª–µ–ª–∏–∑–º–∞
    max_workers=8              # –ë–æ–ª—å—à–µ –ø–æ—Ç–æ–∫–æ–≤
)
```

### –§–∞–∫—Ç–æ—Ä—ã –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏

1. **–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ —è–¥–µ—Ä CPU**: –ë–æ–ª—å—à–µ —è–¥–µ—Ä = –±–æ–ª—å—à–µ –ø–∞—Ä–∞–ª–ª–µ–ª–∏–∑–º–∞
2. **–†–∞–∑–º–µ—Ä —Ñ—Ä–∞–≥–º–µ–Ω—Ç–æ–≤**: 
   - –ú–µ–Ω—å—à–µ —Ñ—Ä–∞–≥–º–µ–Ω—Ç—ã = –±–æ–ª—å—à–µ –Ω–∞–∫–ª–∞–¥–Ω—ã—Ö —Ä–∞—Å—Ö–æ–¥–æ–≤, –Ω–æ –ª—É—á—à–µ —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ
   - –ë–æ–ª—å—à–µ —Ñ—Ä–∞–≥–º–µ–Ω—Ç—ã = –º–µ–Ω—å—à–µ –Ω–∞–∫–ª–∞–¥–Ω—ã—Ö —Ä–∞—Å—Ö–æ–¥–æ–≤, –Ω–æ —Ö—É–∂–µ —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ
3. **–¢–∏–ø –æ–±—Ä–∞–±–æ—Ç–∫–∏**:
   - Silero TTS: –ò–Ω—Ç–µ–Ω—Å–∏–≤–Ω–∞—è CPU –Ω–∞–≥—Ä—É–∑–∫–∞
   - RVC/SoVITS: –ò–Ω—Ç–µ–Ω—Å–∏–≤–Ω–∞—è GPU –Ω–∞–≥—Ä—É–∑–∫–∞

## –ü—Ä–∏–º–µ—Ä—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è

### –ü—Ä–∏–º–µ—Ä 1: –ë—ã—Å—Ç—Ä–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ –ø–æ–¥–∫–∞—Å—Ç–∞

```python
from core.utils.voice_changer import VoiceChanger

changer = VoiceChanger(
    enable_parallel=True,
    chunk_duration_minutes=5
)

result = changer.process_file(
    input_file='podcast.mp3',
    output_file='podcast_female_voice.mp3',
    method='silero',
    voice_model='kseniya',
    preserve_quality=True
)

print(f"–û–±—Ä–∞–±–æ—Ç–∞–Ω–æ –∑–∞ {result.get('duration', 0):.2f} —Å–µ–∫—É–Ω–¥")
changer.cleanup()
```

### –ü—Ä–∏–º–µ—Ä 2: –û–±—Ä–∞–±–æ—Ç–∫–∞ —Å –º—É–∑—ã–∫–æ–π

```python
# –ê—É–¥–∏–æ —Å —Ñ–æ–Ω–æ–≤–æ–π –º—É–∑—ã–∫–æ–π
result = changer.process_file(
    input_file='video_with_music.mp3',
    output_file='video_with_music_new_voice.mp3',
    method='silero',
    voice_model='aidar',
    preserve_background=True,
    vocals_gain=2.0,        # –£–≤–µ–ª–∏—á–∏—Ç—å –≥—Ä–æ–º–∫–æ—Å—Ç—å –≤–æ–∫–∞–ª–∞
    background_gain=-5.0    # –£–º–µ–Ω—å—à–∏—Ç—å –≥—Ä–æ–º–∫–æ—Å—Ç—å —Ñ–æ–Ω–∞
)
```

### –ü—Ä–∏–º–µ—Ä 3: Batch –æ–±—Ä–∞–±–æ—Ç–∫–∞

```python
import os
from pathlib import Path

changer = VoiceChanger(enable_parallel=True, chunk_duration_minutes=5)

input_dir = "data/audio_files"
output_dir = "data/processed_files"

for audio_file in Path(input_dir).glob("*.mp3"):
    output_file = Path(output_dir) / f"processed_{audio_file.name}"
    
    print(f"–û–±—Ä–∞–±–æ—Ç–∫–∞: {audio_file.name}")
    
    result = changer.process_file(
        input_file=str(audio_file),
        output_file=str(output_file),
        method='silero',
        voice_model='kseniya'
    )
    
    print(f"  ‚úÖ –ì–æ—Ç–æ–≤–æ: {output_file.name}")

changer.cleanup()
```

## Troubleshooting

### –ü—Ä–æ–±–ª–µ–º–∞: –ú–µ–¥–ª–µ–Ω–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞

**–†–µ—à–µ–Ω–∏–µ:**
1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –¥–æ—Å—Ç—É–ø–Ω—ã—Ö —è–¥–µ—Ä: `os.cpu_count()`
2. –£–º–µ–Ω—å—à–∏—Ç–µ —Ä–∞–∑–º–µ—Ä —Ñ—Ä–∞–≥–º–µ–Ω—Ç–æ–≤: `chunk_duration_minutes=3`
3. –£–≤–µ–ª–∏—á—å—Ç–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –≤–æ—Ä–∫–µ—Ä–æ–≤: `max_workers=8`

### –ü—Ä–æ–±–ª–µ–º–∞: –û—à–∏–±–∫–∏ –ø–∞–º—è—Ç–∏

**–†–µ—à–µ–Ω–∏–µ:**
1. –£–≤–µ–ª–∏—á—å—Ç–µ —Ä–∞–∑–º–µ—Ä —Ñ—Ä–∞–≥–º–µ–Ω—Ç–æ–≤: `chunk_duration_minutes=10`
2. –£–º–µ–Ω—å—à–∏—Ç–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –≤–æ—Ä–∫–µ—Ä–æ–≤: `max_workers=2`
3. –û—Ç–∫–ª—é—á–∏—Ç–µ –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω—É—é –æ–±—Ä–∞–±–æ—Ç–∫—É –¥–ª—è –æ—á–µ–Ω—å –±–æ–ª—å—à–∏—Ö —Ñ–∞–π–ª–æ–≤

### –ü—Ä–æ–±–ª–µ–º–∞: –†–∞—Å—Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è –ø—Ä–∏ —Å–±–æ—Ä–∫–µ

**–†–µ—à–µ–Ω–∏–µ:**
1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ crossfade –ø–∞—Ä–∞–º–µ—Ç—Ä –≤ `reassemble_chunks`
2. –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –≤—Å–µ —Ñ—Ä–∞–≥–º–µ–Ω—Ç—ã —É—Å–ø–µ—à–Ω–æ –æ–±—Ä–∞–±–æ—Ç–∞–Ω—ã
3. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏ –Ω–∞ –Ω–∞–ª–∏—á–∏–µ –æ—à–∏–±–æ–∫ –≤ –æ—Ç–¥–µ–ª—å–Ω—ã—Ö —Ñ—Ä–∞–≥–º–µ–Ω—Ç–∞—Ö

## –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ –¥–µ—Ç–∞–ª–∏

### –§–æ—Ä–º–∞—Ç —Ñ—Ä–∞–≥–º–µ–Ω—Ç–æ–≤

- –§–æ—Ä–º–∞—Ç: WAV (–Ω–µ—Å–∂–∞—Ç—ã–π)
- –ù–∞–∑–≤–∞–Ω–∏—è: `chunk_0000.wav`, `chunk_0001.wav`, ...
- –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –ø–æ—Ä—è–¥–∫–∞: –ø–æ –∏–Ω–¥–µ–∫—Å—É

### –í—Ä–µ–º–µ–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã

–°—Ç—Ä—É–∫—Ç—É—Ä–∞ –≤—Ä–µ–º–µ–Ω–Ω—ã—Ö –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–π:
```
temp_dir/
‚îú‚îÄ‚îÄ parallel/
‚îÇ   ‚îú‚îÄ‚îÄ chunks/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ chunk_0000.wav
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ chunk_0001.wav
‚îÇ   ‚îú‚îÄ‚îÄ processed_chunks/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ processed_chunk_0000.wav
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ processed_chunk_0001.wav
‚îÇ   ‚îî‚îÄ‚îÄ separation/
‚îÇ       ‚îú‚îÄ‚îÄ vocals.wav
‚îÇ       ‚îî‚îÄ‚îÄ instrumental.wav
‚îî‚îÄ‚îÄ background_preservation/
    ‚îú‚îÄ‚îÄ processed_vocals.wav
    ‚îî‚îÄ‚îÄ ...
```

### –û—á–∏—Å—Ç–∫–∞

–í—Å–µ–≥–¥–∞ –≤—ã–∑—ã–≤–∞–π—Ç–µ `changer.cleanup()` –ø–æ—Å–ª–µ –æ–±—Ä–∞–±–æ—Ç–∫–∏:
```python
try:
    result = changer.process_file(...)
finally:
    changer.cleanup()
```

## API Reference

### ParallelVoiceProcessor

```python
class ParallelVoiceProcessor:
    def __init__(
        self,
        chunk_duration_minutes: int = 5,
        max_workers: Optional[int] = None,
        temp_dir: Optional[str] = None
    )
    
    def split_audio(
        self,
        input_file: str,
        output_dir: Optional[str] = None
    ) -> List[Dict[str, any]]
    
    def process_chunks_parallel(
        self,
        chunks: List[Dict[str, any]],
        processor_func: Callable[[str, str], Dict],
        output_dir: Optional[str] = None
    ) -> List[Dict[str, any]]
    
    def reassemble_chunks(
        self,
        processed_chunks: List[Dict[str, any]],
        output_file: str,
        crossfade_ms: int = 100
    ) -> str
    
    def process_with_background(
        self,
        input_file: str,
        output_file: str,
        voice_processor_func: Callable[[str, str], Dict],
        background_separator_func: Optional[Callable] = None,
        vocals_gain: float = 0.0,
        background_gain: float = -3.0
    ) -> str
    
    def cleanup(self)
```

### VoiceChanger (—Ä–∞—Å—à–∏—Ä–µ–Ω–Ω—ã–π)

```python
class VoiceChanger:
    def __init__(
        self,
        temp_dir: Optional[str] = None,
        device: Optional[str] = None,
        enable_parallel: bool = True,
        chunk_duration_minutes: int = 5,
        max_workers: Optional[int] = None
    )
    
    def process_file(
        self,
        input_file: str,
        output_file: str,
        conversion_type: str = 'male_to_female',
        pitch_shift: Optional[int] = None,
        formant_shift: Optional[float] = None,
        preserve_quality: bool = True,
        voice_model: Optional[str] = None,
        method: str = 'sovits',
        preserve_background: bool = False,
        use_parallel: bool = None
    ) -> Dict[str, any]
    
    def cleanup(self)
```

## Changelog

### Version 1.0 (Current)

- ‚úÖ –ü–∞—Ä–∞–ª–ª–µ–ª—å–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ —Ñ—Ä–∞–≥–º–µ–Ω—Ç–æ–≤
- ‚úÖ –†–∞–∑–¥–µ–ª–µ–Ω–∏–µ –Ω–∞ —Ñ—Ä–∞–≥–º–µ–Ω—Ç—ã –ø–æ –≤—Ä–µ–º–µ–Ω–∏
- ‚úÖ –ü–æ–¥–¥–µ—Ä–∂–∫–∞ —Ñ–æ–Ω–æ–≤–æ–π –º—É–∑—ã–∫–∏
- ‚úÖ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –≤—ã–±–æ—Ä —Ä–µ–∂–∏–º–∞
- ‚úÖ Crossfade –º–µ–∂–¥—É —Ñ—Ä–∞–≥–º–µ–Ω—Ç–∞–º–∏
- ‚úÖ –¢–µ—Å—Ç–æ–≤—ã–π —Å–∫—Ä–∏–ø—Ç
- ‚úÖ –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è

### Planned Features

- üîÑ GPU —É—Å–∫–æ—Ä–µ–Ω–∏–µ –¥–ª—è –∫–∞–∂–¥–æ–≥–æ —Ñ—Ä–∞–≥–º–µ–Ω—Ç–∞
- üîÑ Adaptive chunk sizing (–¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏–π —Ä–∞–∑–º–µ—Ä)
- üîÑ Progress callback –¥–ª—è –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏—è –ø—Ä–æ–≥—Ä–µ—Å—Å–∞
- üîÑ –ö–µ—à–∏—Ä–æ–≤–∞–Ω–∏–µ –æ–±—Ä–∞–±–æ—Ç–∞–Ω–Ω—ã—Ö —Ñ—Ä–∞–≥–º–µ–Ω—Ç–æ–≤
- üîÑ –ü–æ–¥–¥–µ—Ä–∂–∫–∞ –≤–∏–¥–µ–æ —Ñ–∞–π–ª–æ–≤

